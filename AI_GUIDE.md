# AI Guide - FormaSup BI Platform

> Single source of truth for AI assistants (Copilot, ChatGPT, Claude, etc.). Production system: prioritize safety, security, and clarity.

---

## Quick Rules (Read First)

1. **English only** for all code, docs, comments, commits; **no emojis**.
2. **No secrets** in code or logs; always use environment variables.
3. **Do not change architecture**: no edits to `docker-compose.yml`, no DB schema changes, no new services/dependencies without explicit approval.
4. **Protected files**: `superset/config/superset_config.py`, `.env`, `apache-superset-src/`, migration outputs (`siret_corrections.txt`, `siret_invalid.txt`, `siret_errors_api.txt`), backups/dumps.
5. **Testing**: run `./run-tests.sh` (bash) or `./run-tests.ps1` (Windows) before proposing changes; keep coverage ≥80% (migration) and ≥85% (superset).
6. **Security**: keep CSRF enabled, validate inputs, use parameterized queries, avoid logging sensitive data.

---

## Scope & Compliance

- Production BI platform (Apache Superset 6.0.0) for FormaSup Auvergne.
- Compliance: ISO 27001:2022, GDPR (RGPD). Preserve audit trails; respect retention.

---

## Allowed Actions

- Fix bugs with clear justification.
- Add/extend tests; improve docs in English.
- Small refactors keeping behavior; performance optimizations without regressions.
- Add concise comments for complex logic.
- Security hardening and validation improvements.

## Forbidden Actions

- Add new dependencies or services without explicit request.
- Modify `docker-compose.yml`, Superset security config, database schemas, or migration logic shape without approval.
- Disable security (CSRF, auth), expose ports, or hardcode credentials.
- Remove functionality or skip/disable tests.
- Write non-English content or add emojis.

---

## Security Rules

- Secrets via environment variables only; never commit `.env`.
- No logging of passwords, tokens, PII, or SIRET payloads.
- Use parameterized queries; validate all inputs.
- Maintain CSRF protection; follow least-privilege access.
- Keep logs and reports out of git: `logs/migration.log`, `logs/db_metrics.log`, `siret_corrections.txt`, `siret_invalid.txt`, `siret_errors_api.txt`, backups/dumps.

---

## Testing Requirements

- Run tests: `./run-tests.sh` (bash) or `./run-tests.ps1` (Windows).
- Coverage minima: migration ≥80%, superset ≥85%.
- Add tests for new behavior; update tests if behavior changes; do not reduce coverage.

---

## Logging & Outputs

- Default log paths: `logs/migration.log`, `logs/db_metrics.log`; log level via `MIGRATION_LOG_LEVEL` (use `DEBUG` only for troubleshooting).
- Reports generated by SIRET correction must not be committed: `siret_corrections.txt`, `siret_invalid.txt`, `siret_errors_api.txt`.

---

## Coding Standards

### Python

- PEP 8 style; line length ≤100.
- Type hints required for public functions; module/class/function docstrings required.
- Imports sorted/grouped; avoid wildcard imports.

### PowerShell

- Use comment-based help headers; prefer `try/catch`; validate parameters with `[CmdletBinding()]`.

### Markdown

- ATX headers; code blocks with language specifier; relative links when possible; English only; no emojis.

---

## Protected Files / Directories

- `docker-compose.yml`, `superset/config/superset_config.py`, `.env`, `apache-superset-src/`
- Migration outputs: `siret_corrections.txt`, `siret_invalid.txt`, `siret_errors_api.txt`
- Backups/dumps: `backups-files/*.dump`, `*.sql` (except whitelisted in `init/`)
- Logs: `logs/migration.log`, `logs/db_metrics.log`

---

## Commit Guidelines

Format:

```txt
<type>: <description>

Types: Add | Fix | Update | Refactor | Test | Docs | Chore
```

Examples: `Fix: Correct SIRET API mapping`, `Docs: Update migration logging rules`.

---

## Escalation

If a request conflicts with these rules: explain the risk, propose a safe alternative, and seek explicit approval before proceeding.

---

## Version

- **Document version**: 2.0.0
- **Last updated**: January 2026
- **Author**: Marie Challet
- **Organization**: FormaSup Auvergne
